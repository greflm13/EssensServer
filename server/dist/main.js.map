{"version":3,"sources":["main.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import * as express from 'express';\r\nimport * as path from 'path';\r\nimport * as bodyparser from 'body-parser';\r\nimport * as debugsx from 'debug-sx';\r\n\r\nimport * as http from 'http';\r\nimport * as https from 'https';\r\nimport * as child from 'child_process';\r\nimport * as fs from 'fs';\r\n\r\nprocess.env['DEBUG'] = '*';\r\nprocess.env['DEBUG_COLORS'] = 'true';\r\nprocess.env['DEBUG_STREAM'] = 'stdout';\r\nlet date = new Date().toISOString();\r\nconst debug: debugsx.IFullLogger = debugsx.createFullLogger('main');\r\nlet consolelogger: debugsx.IHandler = debugsx.createConsoleHandler('stdout', '*', '-*', [\r\n  { level: /INFO*/, color: 'cyan', inverse: true },\r\n  { level: /FINE*/, color: 'white', inverse: true },\r\n  { level: /SEVERE*/, color: 'red', inverse: true },\r\n  { level: 'ERR', color: 'red', inverse: true },\r\n  { level: 'WARN', color: 'magenta', inverse: true }\r\n]);\r\nlet filelogger: debugsx.IHandler = debugsx.createFileHandler(path.join(__dirname, '../logs/' + date + '.log'), '*', '-*', [\r\n  { level: /INFO*/, color: 'cyan', inverse: true },\r\n  { level: /FINE*/, color: 'white', inverse: true },\r\n  { level: /SEVERE*/, color: 'red', inverse: true },\r\n  { level: 'ERR', color: 'red', inverse: true },\r\n  { level: 'WARN', color: 'magenta', inverse: true }\r\n]);\r\ndebugsx.addHandler(consolelogger, filelogger);\r\n\r\nconst app = express();\r\napp.use(bodyparser.json());\r\napp.use(bodyparser.urlencoded({ extended: true }));\r\napp.set('views', path.join(__dirname, '/views'));\r\nconst pugEngine = app.set('view engine', 'pug');\r\npugEngine.locals.pretty = true;\r\n\r\napp.use(logger);\r\napp.use(express.static(path.join(__dirname, '../public')));\r\napp.use('/assets', express.static(path.join(__dirname, '../../ng2/dist/assets')));\r\napp.use(express.static(path.join(__dirname, '../../ng2/dist')));\r\napp.use('/node_modules', express.static(path.join(__dirname, '../node_modules')));\r\napp.post('/api/putMeHere', putMeHere);\r\napp.get('/api/callMeMaybe', callMeMaybe);\r\napp.get('/delete', del);\r\napp.get('/essen', essen);\r\napp.post('/essen', saveEssen);\r\napp.get('**', (req, res) => {\r\n  res.sendFile(path.join(__dirname, '../../ng2/dist/index.html'));\r\n});\r\napp.use(error404Handler);\r\napp.use(errorHandler);\r\n\r\nconst port = 8080;\r\nconst server = http.createServer(app).listen(port, () => {\r\n  debug.info('Server running on port ' + port);\r\n  server.on('close', () => {\r\n    debug.fine('Server stopped.');\r\n  });\r\n  server.on('err', err => {\r\n    debug.severe(err);\r\n  });\r\n});\r\nconst storedpass = 'enter';\r\nconst storeduser = 'enter';\r\nlet jsonToken = false;\r\n\r\nfunction error404Handler(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  const clientSocket = req.socket.remoteAddress + ':' + req.socket.remotePort;\r\n  debug.warn('Error 404 for %s %s from %s', req.method, req.url, clientSocket);\r\n  res.status(404).sendFile(path.join(__dirname, 'views/error404.html'));\r\n}\r\n\r\nfunction errorHandler(err: express.Errback, req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  const ts = new Date().toLocaleString();\r\n  debug.severe('Error %s\\n%e', ts, err);\r\n  res.status(500).render('error500.pug', {\r\n    time: ts,\r\n    err: err,\r\n    href: 'mailto:greflm13@htl-kaindorf.ac.at?subject=FÃ¼ttr server failed ' + ts,\r\n    serveradmin: 'Florian Greistorfer'\r\n  });\r\n}\r\n\r\nfunction essen(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  res.sendFile(path.join(__dirname, '/views/essen.html'));\r\n}\r\n\r\nfunction saveEssen(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  fs.writeFileSync(path.join(__dirname, '../speisen.json'), JSON.stringify(req.body));\r\n  res.redirect('/');\r\n}\r\n\r\nfunction callMeMaybe(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  switch (req.query.q) {\r\n    case 'schuelers': {\r\n      res.sendFile(path.join(__dirname, '../essen.json'));\r\n      break;\r\n    }\r\n\r\n    case 'essen': {\r\n      res.sendFile(path.join(__dirname, '../speisen.json'));\r\n      break;\r\n    }\r\n\r\n    default: {\r\n      error404Handler(req, res, next);\r\n    }\r\n  }\r\n}\r\n\r\nfunction putMeHere(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  const OK = {\r\n    ok: 'ok'\r\n  };\r\n  switch (req.query.q) {\r\n    case 'schuelers': {\r\n      fs.writeFileSync(path.join(__dirname, '../essen.json'), JSON.stringify(req.body));\r\n      res.sendFile(path.join(__dirname, '../essen.json'));\r\n      break;\r\n    }\r\n\r\n    default: {\r\n      error404Handler(req, res, next);\r\n    }\r\n  }\r\n}\r\n\r\nfunction del(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  fs.writeFileSync(path.join(__dirname, '../essen.json'), '[]');\r\n  fs.writeFileSync(path.join(__dirname, '../speisen.json'), '{\"montag\":\"\",\"dienstag\":\"\",\"mittwoch\":\"\",\"donnerstag\":\"\",\"freitag\":\"\"}');\r\n  res.redirect('/');\r\n}\r\n\r\nfunction logger(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  const clientSocket = req.socket.remoteAddress + ':' + req.socket.remotePort;\r\n  debug.info(req.method, req.url, clientSocket);\r\n  next();\r\n}\r\n"],"sourceRoot":"Z:\\Git\\EssensServer\\server"}